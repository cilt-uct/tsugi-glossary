{% foreach($scripts as $script): %}
<script src="{{$script}}" type="text/javascript"></script>
{% endforeach; %}

<script type="text/javascript">
    jQuery.fn.exists = function () { return this.length > 0; }

    function genCharArray(charA, charZ) {
        var alpha = [], i = charA.charCodeAt(0), j = charZ.charCodeAt(0);

        for (i = 0; i <= j; i++) {
            alpha.push(String.fromCharCode(i));
        }
        if (alpha) {
            $("#show_alphabets").show;
            $("#show_alphabets").html(alpha);
        } else {
            $("#show_alphabets").show;
            $("#show_alphabets").html("Error loading the alphabets");
        }

    }

    function getAlphaTerms() {
        const termList = document.getElementById("term-list");

        // Make an AJAX request to your PHP script
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "fetch_terms.php?alphabet=" + alphabet, true);

        xhr.onload = function() {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);

                // Display the fetched terms
                termList.innerHTML = "<ul>";
                response.forEach(function(term) {
                    termList.innerHTML += "<li>" + term + "</li>";
                });
                termList.innerHTML += "</ul>";
            }
        };

        xhr.send();
    }

    function fetchAllTerms() {
    const termList = document.getElementById("term-list");
        // Make an AJAX request to your PHP script
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "glossary-search.php", true);

        xhr.onload = function() {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);

                // Display the fetched terms with alphabet headings
                termList.innerHTML = "";

                let currentAlphabet = '';
                response.forEach(function(term) {
                    const firstLetter = term[0].toUpperCase();
                    if (firstLetter !== currentAlphabet) {
                        currentAlphabet = firstLetter;
                        termList.innerHTML += "<h2>" + currentAlphabet + "</h2>";
                    }
                    termList.innerHTML += "<p>" + term + "</p>";
                });
            }
        };

        xhr.send();
    }

    function getTermDescription() {
        $('.single').on('click', function (event) {
            event.preventDefault();

        })

    }

    $(function () {
        var glossary_action = '';
        $('btnAlpha').on('click', function () {
            // getAlpaTerms()

        });

        $('#glossary-body').on('click', '#action_buttons button, #action_buttons button .fa, #btn_new_term', function (event) {
            event.preventDefault();

            const _btn = $(this);
            const _btn_action = $(event.target).attr("data-action");
            console.log("button action", _btn);
            
        switch (_btn_action) {
            case "new-term":
                $("#termDeleteDiv").hide();
                $("#termDetailsDiv").show();
                $('#termModalLabel').html('Adding new term');
                $('#inp_term_type').val('addGlossaryTerm');
                $('#btn_save').html('Add');

                break;
            case "edit-term":
                $("#termDeleteDiv, #faculty-section").hide();
                $("#termDetailsDiv").show();

                $('#termModalLabel').html(`Editing: ${_btn.data('term_name')}`);
                $('#inp_term_type').val('updateGlossaryTerm');
                $('#inp_term_id').val(_btn.data('term_id'));
                $('#term_faculty').val(_btn.data('term_domain'));
                $('#term_name').val(_btn.data('term_name'));
                $('#term_definition').val(_btn.data('term_description'));

                break;
            case "delete-term":
                $('#termModalLabel').html(`Deleting <i> '${_btn.data('term_name')}' </i>`);
                $("#termDetailsDiv").hide();
                $("#termDeleteDiv").show();
                $('#inp_term_id').val(_btn.data('term_id'));
                $('#btn_save').html('Delete');
                $('#term_faculty_id, #term_faculty, #term_name, #term_definition').prop('disabled', true);
                $("#termDeleteLabel").html(`Are you sure you want to delete <i>' ${_btn.data('term_name')} '</i> ?`);
                $('#inp_term_type').val('deleteGlossaryTerm');

                break;
            }

            $('#termModal').modal('show');
        });
        
        $("#domain-dropdown").on("click", ".dropdown-item", function(event) {
            event.preventDefault();

            $('#term_faculty').val($(this).data("value"));
            $('#term_faculty_id').val($(this).data("id"));
            console.log("Selected Item: " + $(this).data("id"));
        });

        $("#itemList").on("click", ".delete-btn", function() {
            var listItem = $(this).closest("li");
            var itemId = listItem.data("id");
        // Send an AJAX request to delete the item
        $.ajax({
            type: "POST",
            url: $(this).attr('post_url '),
            data: { id: itemId },
            success: function(response) {
                if (response === "success") {
                    listItem.remove(); // Remove the item from the list
                } else {
                    alert("Failed to delete the item.");
                }
            },
            error: function() {
                alert("Error occurred while deleting the item.");
            }
        });
    });

        $("#termForm").submit(function (event) {
            event.preventDefault();

            const _modal = $('#termModal'),
                _form = $('#termForm'),
                _btn = $('#btn_save'),
                _btnAction = '';

            if (_form[0].checkValidity() === true) {
                if(_btn.html() == 'Delete') {
                    _btn.html('<i class="fa fa-cog fa-spin"></i>&nbsp;&nbsp;Deleting ...').addClass('disabled').attr('disabled', true);
                } else if(_btn.html() == 'Add') {
                    _btn.html('<i class="fa fa-cog fa-spin"></i>&nbsp;&nbsp;Adding term ...').addClass('disabled').attr('disabled', true);
                } else {
                    _btn.html('<i class="fa fa-cog fa-spin"></i>&nbsp;&nbsp;Updating ...').addClass('disabled').attr('disabled', true);
                }
                 var formData = $(this).serialize();
                
                $.ajax({
                    type: "POST",
                    url: '{{ $post_url }}',
                    data: formData,
                    success: function(response) {
                        alert("Data saved successfully!");
                        // _btn.html('Delete').removeClass('disabled').attr('disabled', false);
                        console.log(response);
                        $('#termModal').modal('toggle');
                    },
                    error: function(error) {
                        alert("Oops! Something went wrong! Please try again later.");
                        console.log("encounted error",error);
                    }
                });
            }
            _form.addClass('was-validated');
        });

        $('#termModal').on('hidden.bs.modal', function (e) {
            location.reload();
        });
      
        $('#btn_cancel_termModal').on('click', function (event) {
            event.preventDefault();
            $('#termModal').modal('hide');
        });

        $('#searchBox').on('keyup', function() {
       
            var searchTerm = $(this).val();
            $.get('search.php', { searchTerm: searchTerm }, function(data) {
                $('#searchResults').html(data);

                //     $(document).ready(function() {
                // $('#searchButton').on('click', function(event) {
                //     event.preventDefault();
                //     event.stopPropagation();

                //     // Get the value entered in the input box
                //     var searchTerm = $('#searchBox').val();
                //     searchWord(searchTerm);
                //     });
            });
        });

        $("#viewAll").on('click', function(e) {
            e.preventDefault();

            $("#divTopTerms").hide();
            $("#divSearchForTerms").show();
        });

        $('#alphaButtons').on('click', '.alphabet-button', function() {
            var clickedAlphabet = $(this).data('alphabet');

            // {{ $alphabet_terms }}

            console.log('Clicked: ' + clickedAlphabet);
        });

        $(document).ready(function() {
            
            var alphabets = Array.from({ length: 26 }, (_, i) => String.fromCharCode(65 + i));
            alphabets.forEach(function(alphabet) {
                var button = $('<button type="button" class="btn btn-primary btn-xs">').text(alphabet)
                                        .addClass('alphabet-button')
                                        .attr('data-alphabet', alphabet)
                                        .attr('id', 'btnAlpha')
                                        .attr('name', 'btnAlpha');
                $('#alphaButtons').append(button);
            });


            // Event handler for the search button
            $("#searchButton").on("click", function() {
            var searchTerm = $('#searchBox').val().toLowerCase(); 
            $('#termList').html("");

            // Send an AJAX request to fetch terms from the database
            $.ajax({
                url: '{{$post_url}}',
                method: 'GET',
                dataType: 'json',
                success: function(response) {
                    // Iterate through the fetched terms and display matching ones
                    response.forEach(function(term) {
                        if (term.toLowerCase().includes(searchTerm)) {
                            $('#termList').append("<p>" + term + "</p>");
                        }
                    });
                },
                error: function(error) {
                    console.log("Error fetching terms from the database: " + error);
                }
                });
            });

            $("#searchButton").on("click", function() {
                var searchTerm = $('#searchBox').val().toLowerCase(); 
                $('#termList').html("");

                // Send an AJAX request to fetch terms from the database
                $.ajax({
                    url: '{{$post_url}}',
                    method: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        // Iterate through the fetched terms and display matching ones
                        response.forEach(function(term) {
                            if (term.toLowerCase().includes(searchTerm)) {
                                $('#termList').append("<p>" + term + "</p>");
                            }
                        });
                    },
                    error: function(error) {
                        console.log("Error fetching terms from the database: " + error);
                    }
                });
            });
        
            $("#languageSelect").on("change", function () {
                const selectedLanguage = this.value;
                const xhr = new XMLHttpRequest();

                xhr.open("GET", `/get-terms?language=${selectedLanguage}`, true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        const terms = JSON.parse(xhr.responseText);

                        // Update the 'termsContainer' with the terms received from the server
                        document.getElementById("termsContainer").innerHTML = terms;
                    }
                };
                xhr.send();
            });
            
        });
});
</script>